from fnewscrawler.mcp import mcp_server
from fnewscrawler.spiders.eastmoney import get_industry_stock_funds_flow, get_industry_history_funds_flow


@mcp_server.tool(title="获取行业历史资金流")
async def get_industry_history_funds_flow_tool(industry_name: str):
    """
    获取指定行业近期历史资金流向数据，分析行业整体资金面变化趋势

    此工具基于东方财富数据，提供行业层面的资金流向分析，帮助判断市场对整个行业的
    资金配置偏好和投资情绪变化，是进行行业轮动分析和板块投资决策的重要工具。

    适用场景：
    - 分析行业整体资金流入流出趋势，判断行业景气度
    - 识别主力资金重点布局或撤离的行业板块
    - 研究行业轮动中的资金流向规律
    - 评估政策利好对相关行业资金面的影响
    - 寻找资金流入但股价滞涨的行业投资机会
    - 监控系统性风险下各行业资金撤离情况

    参数说明：
    :param industry_name: 行业名称，仅支持东方财富标准行业分类，包括以下行业：
        - 制造业：通用设备、专用设备、汽车整车、汽车零部件、船舶制造、航天航空、
          消费电子、电机、家电行业、纺织服装、电子元件、交运设备、橡胶制品
        - 资源能源：有色金属、能源金属、小金属、贵金属、采掘行业、石油行业、
          煤炭行业、电力行业、燃气、公用事业
        - 化工材料：化学原料、化学制品、化学制药、化纤行业、塑料制品、
          玻璃玻纤、包装材料、非金属材料、化肥行业、农药兽药
        - 科技通信：半导体、软件开发、计算机设备、通信设备、通信服务、
          电子化学品、光学光电子、电子元件
        - 金融服务：银行、证券、保险、多元金融
        - 医药健康：医疗器械、医疗服务、生物制品、中药、化学制药、医药商业、美容护理
        - 消费服务：食品饮料、酿酒行业、商业百货、旅游酒店、文化传媒、游戏、教育
        - 基建地产：房地产开发、房地产服务、工程建设、装修装饰、装修建材、
          水泥建材、工程机械、铁路公路、航空机场
        - 其他：综合行业、贸易行业、物流行业、航运港口、环保行业、专业服务等

        请严格使用上述标准行业名称，如"半导体"、"汽车整车"、"医疗器械"等

    返回数据字段详解：
    - 日期：资金流数据对应的交易日期
    - 主力净流入净额：机构和大户资金净流入总额（亿元/万元）
    - 主力净流入净占比：主力净流入占该行业总成交额的比例
    - 超大单净流入净额：超大额交易（通常>500万）净流入金额
    - 超大单净流入净占比：超大单净流入占总成交额比例
    - 大单净流入净额：大额交易净流入金额（亿元/万元）
    - 大单净流入净占比：大单净流入占总成交额比例
    - 中单净流入净额：中等金额交易净流入（亿元/万元）
    - 中单净流入净占比：中单净流入占总成交额比例
    - 小单净流入净额：小额交易净流入，主要反映散户资金（亿元）
    - 小单净流入净占比：小单净流入占总成交额比例

    数据解读要点：
    - 主力净流入为正且持续：表明机构看好该行业前景，值得关注
    - 超大单大幅净流入：可能有重大利好消息或政策推动
    - 主力流入而小单流出：专业资金看好，散户情绪谨慎，潜在机会
    - 主力大幅流出：需警惕行业基本面变化或估值风险
    - 各类资金同向流动：行情趋势明确，反向流动则需谨慎判断

    :return: Markdown格式的行业历史资金流数据表格，展示近期该行业的详细资金流向变化
    """
    markdown_table = await get_industry_history_funds_flow(industry_name)
    return markdown_table


@mcp_server.tool(title="获取指定行业内所有个股的资金流排名")
async def get_industry_stock_funds_flow_tool(industry_name: str,rank_type="1day"):
    """
    获取指定行业内所有个股的指定时间周期的资金流向排名数据，筛选行业内资金流入最强的个股

    此工具提供行业内个股级别的资金流向对比分析，帮助在看好的行业中精选个股，
    是自上而下投资策略中从行业配置到个股选择的关键分析工具。

    适用场景：
    - 在看好的行业中筛选资金流入最强的龙头股
    - 对比同行业个股的资金面表现，寻找超跌反弹机会
    - 识别行业内异常资金流动的个股（可能有重大消息）
    - 分析行业内资金分化情况，判断龙头效应强弱
    - 监控行业轮动中的个股资金流向变化
    - 寻找涨幅滞后但资金流入的潜力个股

    参数说明：
    :param industry_name: 行业名称，仅支持东方财富标准行业分类，只能从以下行业中选择：
        通用设备、汽车零部件、专用设备、船舶制造、
        航天航空、消费电子、电机、家电行业、纺织服装、电子元件、游戏、
        交运设备、橡胶制品、航运港口、互联网服务、有色金属、电池、保险、
        专业服务、化纤行业、装修装饰、汽车服务、燃气、造纸印刷、环保行业、
        仪器仪表、能源金属、综合行业、化学原料、采掘行业、公用事业、
        玻璃玻纤、珠宝首饰、石油行业、塑料制品、电源设备、包装材料、
        房地产服务、软件开发、电子化学品、装修建材、美容护理、电网设备、
        教育、铁路公路、航空机场、化肥行业、贸易行业、家用轻工、酿酒行业、
        计算机设备、煤炭行业、工程咨询服务、风电设备、农药兽药、多元金融、
        物流行业、房地产开发、小金属、钢铁行业、化学制品、非金属材料、
        通信服务、食品饮料、农牧饲渔、光伏设备、汽车整车、证券、半导体、
        贵金属、医药商业、商业百货、工程机械、电力行业、旅游酒店、
        工程建设、医疗服务、光学光电子、医疗器械、银行、水泥建材、
        文化传媒、生物制品、中药、通信设备、化学制药

    :param rank_type: 排名类型，可选值包括：
        - 1day：今日排名（默认）
        - 5day：5日排名
        - 10day：10日排名
    :return: Markdown格式的行业个股资金流排名表格，按主力净流入金额降序排列
    """
    if rank_type not in ["1day","5day","10day"]:
        return "rank_type must be 1day,5day or 10day"
    markdown_table = await get_industry_stock_funds_flow(industry_name,rank_type)
    return markdown_table
from fnewscrawler.mcp import mcp_server
from fnewscrawler.spiders.iwencai import get_history_funds_flow


@mcp_server.tool(title="获取个股历史资金流工具")
async def get_history_funds_flow_tool(stock_code: str):
    """
    获取指定股票近30个交易日的详细资金流向数据

    此工具用于分析股票的资金流入流出情况，帮助判断主力资金动向和市场情绪。
    适用场景：
    - 分析股票的主力资金流向趋势
    - 研究大单、中单、小单的资金分布情况  
    - 评估近期资金面对股价的影响
    - 结合涨跌幅分析资金流与股价表现的关系

    参数说明：
    :param stock_code: 股票代码，支持格式如：
        - A股：000001（平安银行）、600036（招商银行）
        - 创业板：300750（宁德时代）
        - 科创板：688981（中芯国际）
        不需要添加交易所前缀，直接使用6位数字代码

    返回数据包含以下关键指标：
    - 日期：交易日期（YYYYMMDD格式）
    - 收盘价：当日收盘价格
    - 涨跌幅：相对前一交易日的涨跌百分比
    - 资金净流入：当日总体资金净流入额（万元）
    - 5日主力净额：近5日主力资金累计净流入（万元）
    - 大单(主力)净额：大额交易资金净流入（万元）
    - 大单(主力)净占比：大单资金占总成交额比例
    - 中单净额：中等金额交易资金净流入（万元）
    - 中单净占比：中单资金占总成交额比例  
    - 小单净额：小额交易资金净流入（万元）
    - 小单净占比：小单资金占总成交额比例

    数据解读要点：
    - 正值表示净流入，负值表示净流出
    - 主力净额反映机构和大户的资金动向
    - 中小单净额反映散户资金流向
    - 结合涨跌幅可判断资金推动还是情绪推动的行情

    :return: Markdown格式的资金流数据表格，包含近30个交易日的完整资金流向信息
    """
    markdown_table = await get_history_funds_flow(stock_code)
    return markdown_table